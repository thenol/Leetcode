# 换根DP（Rooted DP）介绍

**换根DP**（Rooted Dynamic Programming，简称换根动态规划）是一种在树形结构中非常常见的优化技术，主要用于树形结构问题中，特别是那些涉及子树和根节点的动态规划问题。换根DP的核心思想是通过**两次深度优先搜索（DFS）**来计算树中每个节点作为根时的某个属性值（如子树大小、路径和、最短路径等）。

## 换根DP的基本思想

换根DP的核心思想是，通过两次深度优先搜索（DFS），首先计算树的某个节点作为根时的答案，然后利用已经计算出的父节点信息，递归地更新每个子节点的答案，从而实现换根操作。

### 主要步骤：
1. **第一次DFS：** 从某个根节点开始，计算这个节点为根时的答案，并且记录下每个节点的状态信息。
2. **第二次DFS：** 利用已经计算出的父节点信息，递归更新每个子节点的答案，从而实现换根操作。

### 换根DP的递推关系
假设我们需要计算树上每个节点作为根时的某些值（如子树大小、路径长度等），首先定义状态 `dp[x]` 来表示以节点 `x` 为根时的某个值。

1. **第一次DFS：** 从根节点开始，计算每个节点作为根时的答案。
2. **第二次DFS：** 通过父节点的信息更新子节点的答案。公式如下：
   \[
   dp[y] = dp[x] - dp[y]
   \]
   这里的意思是：假设我们将根从节点 `x` 换到子节点 `y`，那么节点 `y` 的子树大小就是节点 `x` 的子树大小减去 `y` 的子树大小。

## 换根DP的应用

换根DP广泛应用于以下几类问题：
- **树的路径问题：** 计算树中从根到任意节点的路径和，或者树中两节点之间的最短路径。
- **子树的大小：** 计算树中每个节点的子树大小，或者每个节点作为根时的子树贡献。
- **树上最大/最小路径值：** 计算树上从一个节点到另一个节点的路径上的某些属性（如权值、最大值、最小值等）。

### 示例问题：计算树中每个节点的子树大小

假设我们有一个树，需要计算每个节点作为根时，其子树的大小。我们可以使用换根DP来解决这个问题。

#### 代码示例：
```python
class Solution:
    def countSubtreeSizes(self, n: int, edges: List[List[int]]) -> List[int]:
        # 创建邻接表
        g = [[] for _ in range(n)]
        for u, v in edges:
            g[u].append(v)
            g[v].append(u)
        
        # dp[i]表示以节点i为根的子树大小
        dp = [0] * n
        
        # 计算每个节点作为根时的子树大小（第一次DFS）
        def dfs1(x: int, fa: int):
            dp[x] = 1  # 当前节点本身算一个
            for y in g[x]:
                if y != fa:
                    dfs1(y, x)
                    dp[x] += dp[y]  # 累加子树大小
        
        # 第二次DFS，换根操作
        def dfs2(x: int, fa: int):
            # 如果fa是x的父节点，当前dp[x]是根的子树大小
            for y in g[x]:
                if y != fa:
                    # 将y作为根时的子树大小转移到x
                    dp[y] = dp[x] - dp[y]
                    dfs2(y, x)
        
        # 从根节点0开始计算
        dfs1(0, -1)
        
        # 第二次DFS，计算换根后的结果
        dfs2(0, -1)
        
        return dp
